https://time.geekbang.org/column/article/12806

0.Redis相比memcached有哪些优势：

memcached所有的值均是简单的字符串，redis作为其替代者，支持更为丰富的数据类型
redis的速度比memcached快很多
redis可以持久化其数据



1.Spring 的原理？AOP 和 IOC 的原理

1.方便解耦，简化开发 Spring提供的IoC
通过Spring提供的IoC容器，可以将对象之间的依赖关系交由Spring进行控制，避免硬编码所造成的过度程序耦合。
IOC是一种思想，它能指导我们如何设计出松耦合、更优良的程序。 有了IOC容器后，把创建和查找依赖对象的控制权交给了容器，由容器进行注入组合对象，
所以对象与对象之间是松散耦合，这样也方便测试，利于功能复用，更重要的是使得程序的整个体系结构变得非常灵活。
依赖注入的作用：减少类间耦合度，避免用new来创建对象
2.AOP编程的支持 动态代理
通过Spring提供的AOP功能，方便进行面向切面的编程，如性能监测、事务管理、日志记录等。
3.声明式事务的支持
4.方便集成各种优秀框架
5.降低Java EE API的使用难度
如对JDBC，JavaMail，远程调用等提供了简便封装




2.Java容器有哪些？哪些是同步容器,哪些是并发容器？
   同步容器主要包括2类：
        1）Vector、Stack、HashTable  
        2）Collections 工具类中提供的同步集合类 synchronizedMap
	并发容器
	   1. Map类型：ConcurrentMap
     2  S et类型：ConcurrentSkipListSet、CopyOnWriteArraySet
      3 List类型：CopyOnWriteArrayList
	
	 


3.一个线程的生命周期有哪几种状态？它们之间如何流转的？
1.新建new:创建后尚未启动的线程处于这种状态 重写Thread.run或者实现Runnable接口:Start
2.运行runnable:runnable包括了操作系统线程状态中的running和ready，也就是处于此状态的线程有可能正在执行，也有可能正在等待着CPU为它分配执行时间。
3.无限期等待waiting：不会被分配CPU执行时间等待被其他线程显示的唤醒。Object.wait、Thread.join、LockSupport.park
4.限期等待timed waiting ：不会被分配CPU执行，无须等待被其他线程显示地唤醒，自动唤醒。Thread.sleep(long)、Object.wait(long)、Thread.join(long)、LockSupport.parkNanos()、LockSupport.parkUntil()
5.阻塞blocked 线程被阻塞了，阻塞状态与等待状态的区别是:阻塞状态运行状态runnable遇到synchronized隐式锁转换为blocked
6.结束terminated :已终止线程的线程状态，线程已经结束执行。


4.什么是活锁、饥饿、无锁、死锁？怎么检测一个线程是否拥有锁？
活锁 互相谦让
饥饿 没有优先级
无锁 CAS
Thread.holdsLock 判断当前线程是否有锁

5.如何解决同时存在的对象创建和对象回收问题
  1.STW 垃圾收集
  2.并行处理 短暂的stw

6.说说一致性 Hash 原理
 散列函数的构造函数
一致性hash算法将Hash函数的值域空间组织成一个大的圆环
根据构造函数选择对应的区间


7.新生代分为几个区？使用什么算法进行垃圾回收？为什么使用这个算法？
1.标记清除算法（mark sweep） 缺点1：标记和清除效率都不高；缺点2:收集后没有大块的空闲空间给大对象
2.复制算法(新生代用jvm8Eden：1From survivor：1To Survivor):把内存分为1V1，只用一半，收集时，把还存活的复制到另一半，把之前的整块清理
3.标记清除整理算法（老年代用）：比算法1多了一个整理；把存活的内存复制到一起，清理其余的内存
4.分代算法(Generational Collection)不同模块用不同算法
初始标记(需要STW)
并发标记(并发处理)
重新标记(需要STW)
并发清除(并发处理)


8.HashMap在什么情况下会扩容，或者有哪些操作会导致扩容？
CAPACITY=16  扩容因子0.75
>= 当前容量*扩容因子



9.HashMap检测到hash冲突后，将元素插入在链表的末尾还是开头？
散列函数
冲突后会将元素插入在链表的开头


10.1.8还采用了红黑树，讲讲红黑树的特性，为什么大家一定要用红黑树而不是AVL、B树之类的？
红黑树是二叉树的变种
AVL树自平衡二叉树
（1）AVL树是更加严格的平衡，因此可以提供更快的查找速度，一般读取查找密集型任务，适用AVL树。
（2）红黑树更适合于插入修改密集型任务。
（3）通常，AVL树的旋转比红黑树的旋转更加难以平衡和调试。
B树 平衡的多叉树 比红黑树树高要小 尝试回答一下，多路数 大数据量的时候才有优势


11.https和http区别，有没有用过其他安全传输手段？
 AES（高级加密算法）的对称算法。https443


12.线程池的工作原理，几个重要参数，然后给了具体几个参数分析线程池会怎么做，最后问阻塞队列的作用是什么？
corePoolSize ：核心线程数量
maximumPoolSize ：线程最大线程数
workQueue ：阻塞队列，存储等待执行的任务 很重要 会对线程池运行产生重大影响
keepAliveTime ：线程没有任务时最多保持多久时间终止
unit ：keepAliveTime的时间单位
threadFactory ：线程工厂，用来创建线程
rejectHandler ：当拒绝处理任务时的策略

Executors 一克在克特死
newCachedThreadPool() 可灵活回收空闲线程，若无可回收，则新建线程
newFixedThreadPool 无界的工作队列 固定的 可控制线程最大并发数，超出的线程会在队列中等待
newSingleThreadExecutor()  单独的 指定顺序(FIFO, LIFO, 优先级)
newScheduledThreadPoo 支持定时及周期性任务执行 定时延迟三秒执行



13.RabbitMQ
 上的一个 queue 中存放的 message 是否有数量限制？
可以认为是无限制，因为限制取决于机器的内存，但是消息过多会导致处理效率的下降。

I.RabbitMQ 允许发送的 message 最大可达多大？
答：根据 AMQP 协议规定，消息体的大小由 64-bit 的值来指定，所以你就可以知道到底
能发多大的数据了。

14.有使用过哪些NoSQL数据库？MongoDB和Redis适用哪些场景？
redis 缓存东西
mongodb展示等json

 

 
15.查询中哪些情况不会使用索引？
1.索引列有函数运算，饮食类型转换
2.数据少，
3.！= <> 不等于不走
4.like 非前缀的  not in 不走 、is not null


16.描述分布式事务之TCC服务设计？
TCC是一种比较成熟的分布式事务解决方案，可用于解决跨库操作的数据一致性问题；
两阶段编程模型，其Try、Confirm、Cancel 




17.Mysql主从同步的实现原理？
 异步模式（mysql async-mode）
 半同步模式(mysql semi-sync) 等一台slave结束
 全同步模式 全部slave结束
 binlog的三种方式:基于SQL语句的复制 ，基于行的复制 ，混合模式复制 
 
 
18.MySQL是怎么用B+树？
自平衡的搜索树
1.叶子结点不存数据
2.叶子结点之间有索引适合范围
B+树的磁盘读写代价更低：
B+树的内部节点并没有指向关键字具体信息的指针，因此其内部节点相对B树更小
由于B+树的数据都存储在叶子结点中，分支结点均为索引，方便扫库，只需要扫一遍叶子结点即可，
但是B树因为其分支结点同样存储着数据，我们要找到具体的数据，需要进行一次中序遍历按序来扫，
所以B+树更加适合在区间查询的情况，所以通常B+树用于数据库索引。



19.谈谈数据库乐观锁与悲观锁?
乐观锁比较适合并发量不高，并且写操作不频繁的场景 
增加段version 
 
数据库悲观锁 一致性读for update
1.一致性非锁定读(RC和RR级别下可用) MVCC多版本并发控制，别人锁定也能读.通过undo日志实现

2.一致性锁定读
select for update;加排他锁读
select lock in share mode;加共享锁读


 
20.Redis 的数据结构
string,
hash, 哈希表
list,双向链表
set 底层哈希表不可重复 交集并集什么的
zset(sorted set)



21.海量数据过滤，黑名单过滤一个 url。
散列函数，计算值冲突处理 空间换时间
布隆过滤器 :二进制矢量和一系列随机映射函数。



22.讲一讲AtomicInteger，为什么要用CAS而不是synchronized？
synchronized阻塞效率不高
cas系统指令效率高  ABA加版本

 
23.Redis 的   zset 的底层实现
zset：底层分别使用ziplist（压缩链表）和skiplist（跳表）实现。
 压缩链表  1保存的元素少于128个、2 保存的所有元素大小都小于64字节

skiplist（跳表）




24.分布式架构设计哪方面比较熟悉
主流架构模型-SOA和微服务
CAP和BASE理论
单点故障、限流服务降级 、
cdn加速
监控




25.分布式 session 的共享方案有哪些，有什么优劣势
session复制 每台机器有全量
session绑定 同样用户请求到相同机器
利用cookie记录session 
session服务器 redis、memcached)


26.谈谈分布式锁、以及分布式全局唯一ID的实现比较？

全局唯一，区别于单点系统的唯一，全局是要求分布式系统内唯一。
有序性，通常都需要保证生成的 ID 是有序递增的。例如，在数据库存储等场景中，有序 ID 便于确定数据位置，往往更加高效。
4.MongoDB 的ObjectId提 Time+Machine+PID+INC自增计数器
1基于UUID
2基于数据库主键自增
3Reids INCR

分布式锁:
   基于数据库实现分布式锁 
    基于缓存（redis，memcached，tair）实现分布式锁
    基于Zookeeper实现分布式锁
    
    
但是zk做高并发的分布式锁比redis稍逊，因为zk不适合大规模集群部署
Zk的分布式锁的应用场景，主要高可靠，而不是太高并发的场景下。
在并发量很高，性能要求很高的场景下，推荐使用基于redis的分布式锁。


CPU内存磁盘网络GC响应时间
27.集群监控的时候，重点需要关注哪些技术指标？这些指标如何优化？
CPU 负载
内存使用
磁盘IO
网络IO
tps表示每秒处理的I/O请求数
GC
接口响应时间


28.从千万的数据到亿级的数据，会面临哪些技术挑战？你的技术解决思路？
从用户发起说，页面优化 压缩JS等 CDN页面缓存 http合并静态文件
负载均衡策略 LVS NG 限流
接口缓存，redis读取数据
消息队列，削峰填谷。
rpc框架 水平增加机器。
分库分表。等



29.排序算法的复杂度，快速排序非递归实现。

1.交换排序-气泡BubbleSort：算法的基本思想：将待排序的记录看作是竖着排列的“气泡”，关键字较小的记录比较轻，从而要往上浮。
平均情况:时间复杂度为O(n2)、空间复杂度为O(1)

2.交换排序-快速排序-两头排QuickSort 不稳定47<=X<268
最左边是基准，左边找第一个大于它的，右边找第一个小于它的，交换。找到中间，替换基准
算法的基本思想:通过一趟排序将要排序的数据分割成独立的两部分，其中一部分的所有数据都比另外一部分的所有数据都要小，然后再按此方法对着两部分数据分别进行快速排序，整个排序过程可以递归进行，以此达到整个数据变成有序序列。
时间复杂度为O(nlog2n)、空间复杂度为O(log2n)

3.选择排序-直接选择:算法的基本思想:每趟排序在当前待排序序列中选出关键字值最小 的记录，添加到有序序列中。
气泡排序区别：气泡排序每次比较后，如果发现顺序不对立即进行交换，而选择排序不立即进行交换，而是找出最小关键字记录后再进行交换。

4.选择排序-堆排序（完全二叉树）直接选择升级版-把数据组成一个堆完全二叉树（最上边是极值）



5.插入排序-直接插入(扑克牌)稳定:算法的基本思想：插入排序的主要操作是插入，其基本思想是：每次将一个待排序的记录按其关键字的大小插入到一个已经排好序的有序序列中，直到全部记录排好序为止。
时间复杂度为O(n2)、空间复杂度： O(1)

6.插入排序-折半插入:(插入优化，插入有序部分时从中间找)  直接插入排序， 在插入第 i（ i＞ 1）个记录时，前面的 i-1个记录已经排好序，则在寻找插入位置时，可以用折半查找来代替顺序查找，从而较少比较次数。





30.消息中间件有哪些？他们之间的优劣势？
Kafka、ActiveMQ、RabbitMQ、RocketMQ
解耦、异步、削峰。
RocketMQ
ActiveMQ


I.介绍项目
I.介绍你实践的性能优化案例，以及你的优化思路



技术一面（注重问了基础）：
 
常见集合类的区别和适用场景？
并发容器了解哪些？
如何判断链表是否有环？
平时会用到哪些数据结构？
解决hash冲突的方法有哪些？
讲讲自己对HashMap的理解，以及和Weakhashmap的区别？
concurrentHashMap如何实现？
集群服务器 如何application 共享？
BIO、NIO、AIO的区别和联系？
jvm内存模型jmm 知道的全讲讲
JAVA的垃圾回收，标记算法和复制算法的区别，用在什么场合？
12.http和https的区别，http1.x和http2.0的区别，SSL和TSL之间的区别？
12.1、https使用需要CA证书，大部分都是付费使用的
12.2、http默认使用80端口，https默认使用443端口
12.3 http 1.*缺陷：线程阻塞，在同一时间，同一域名的请求有一定数量限制，超过限制数目的请求会被阻塞。
12.4 http 2.*使用报头压缩，降低开销、完全多路复用  



GC、G1和ZGC的区别？
B+树和B树的区别，和红黑树的区别？
内存泄漏与内存溢出的区别？
session的生命周期是多久？
关于Mina框架了解多少？（因为我在项目里用到了Mina，所以提到了这个部分）



技术二面（大多是数据库缓存等）：

自我介绍，讲了下项目！
java cas原理
JAVA线程池有哪些参数，如果自己设计一个线程池要考虑哪些问题？
Java的lock的底层实现？
mysql数据库默认存储引擎，有什么优点
MySQL的事务隔离级别，分别解决什么问题。
四个表 记录成绩，每个大约十万条记录，如何找到成绩最好的同学
常见的负载均衡算法有哪些 (顺序 随机 最小 hash)LVS(顺序 随机 最小 )
如果Redis有1亿个key，使用keys命令是否会影响线上服务
Redis的持久化方式，aod和rdb，具体怎么实现，追加日志和备份文件，底层实现原理知道吗
开一个线程：专门去
技术三面（主要是分布式架构）：

自我介绍，讲下项目！
请画一个完整大型网站的分布式服务器集群部署图
多个RPC请求进来，服务器怎么处理并发呢
讲一下Redis的哨兵机制
数据库分库分表一般数据量多大才需要？
如何保证数据库与redis缓存一致的
项目中消息队列怎么用的？使用哪些具体业务场景？
JVM相关的分析工具有使用过哪些？具体的性能调优步骤吗？
MySQL的慢sql优化一般如何来做？除此外还有什么方法优化？
线上的服务器监控指标，你认为哪些指标是最需要关注的？为什么？
如何做压测，抗压手段
秒杀模块怎么设计的

