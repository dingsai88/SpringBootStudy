
TCP(Transmission Control Protocol)传输控制协议





SYN (Synchronize Sequence Numbers)同步序列号
ACK (Acknowledge character) 确认 AcknowledgeNum

SYN+ACK

FIN(finish结束)

**TCP三次握手**

1.C > S
SYN (S1) 发送一个同步序列号 A


2.S > C
返回一个新的SYN
SYN (S2)  +  ACK(S1+1)


3.C >S 
发送一个ACK给服务端
ACK(S2+1)


**TCP四次挥手**

1.C > S
FIN发送到服务端

C进入到FIN_WAIT_1 

2.S>C
ACK答复客户端

C进入到FIN_WAIT_2 

3.S>C
FIN发送到客户端

C进入到TIME_WAIT 

4.C>S
ACK发送到服务端



----------------------------------------------


TCP三次牵手：
1.C>(牵手a)>S
2.S>(牵手a+1、牵手b)>C
3.C>(牵手b+1)> S

Tcp四次挥手:
1.C>(FIN)>S
2.S>(ACK)>C
3.S>(FIN)>C
4.C>(ACK)>S






https是加了 SSL的http(非对称加密算法)



HTTP/1.1的缺陷 (不安全和性能低)
1、高延迟--带来页面加载速度的降低
浏览器限制连接个数
2、无状态特性--带来的巨大HTTP头部
3、明文传输--带来的不安全性

HTTP/2 2015年发布
1.二进制传输
2.head压缩
3.多路复用(减少浏览器连接限制)
4.服务端经过确认可以向客户端推送信息JS、css


HTTP/3 新特性:基于UDP性能更高
2中有TCP对头阻塞问题


I.RPC和http区别： 远程过程调用、超文本传输协议
相同:都是TCP、都是socket

不同:
通用性http更高性能相对较低、RPC性能更高需要两端序列化反序列化
(负载均衡、服务治理一般RPC都自带)、(http要自己弄)

rpc一般适合内部调用、性能高、方便治理、一般可以像调用本地方法式的调用；
http对外的异构环境、浏览器、app、三方接口都可以、需要自己序列化成对象。







# tcp ip



I.TCP/IP分四层
II.应用层(FTP、Telnet、SMTP)
II.运输层(TPC、UDP)
II.网络层(IP、ICMP、 IGMP)ICMP是附属协议
II.链路层(驱动、接口等)ARP,RARPk



II.ping、traceroute使用了ICMP协议
查看到目的节点经过的跳数

II.点分十进制表示法

II.互联网每个节点必须有唯一的IP地址:互联网信息中心管理


II.IP地址有三类
单播地址、广播地址、多播地址


II.客户-服务器模型
III.重复型:只能同时处理一个请求 UDP
III.并发型:能同时处理多个请求   TCP


II.端口
TCP、UDP采用16bit端口号识别应用程序
任何TCP\IP实现的服务都是1-1023之间
256-1023是Unix系统占用

客户端不关心自己使用的端口号,又叫临时端口号
TCP/IP实现临时端口号一般分配1024-5000


II.编程接口:
III.socket
III.TLI(Transport layer interface)




------------------------------------------------------------------------------------------------------------------------------------------

I.链路层
目的:
1.IP模块发送和接受IP信息
2.arp模块发送ARP请求和接收ARP应答
3.RARP发送RARP请求和接收RARP信息

支持多种链路层协议，取决于硬件:
以太网、令牌环网、FDDI、RS-232

II.协议:SLIP、PPP、以太网和IEEE802
以太网帧要在46-1500之间



II.协议的最大传输单元MTU
IP层传输报文大于MTU就要进行分片
超通道65535
16Mb/s令牌环 17914
以太网   1500
IEEE 802.3/802.2 1492
点对点 296


II.路径MTU
两台主机之间的最小MTU就是路径MTU
查看路径mtu
ping -f -l 1472 www.gdin.edu.cn
如果成功就不需要拆包
否则Packet needs to be fragmented but DF set.
把数据包长度加上数据包头28字节，就得到MTU的值。
默认值为网关的MTU值是1500。


-----------------------------------------------------------------------------------------------------------

I.IP网际协议
所有TCP、UDP、ICMP、IGMP数据都是以IP协议报文传输

不可靠:不保证数据报能成功的到达目的地，出现错误丢弃数据报，然后发送ICMP信息给信源端
无连接:每个数据报互相独立,没有发送顺序

II.IP首部
III.版本:IPV4
III.首部长度:4个字节，1个字节最大十进制是15，4个字节最大值就是60字节。默认20字节
III.服务类型:最小时延、最大吞吐、最高可靠性、最小费用
III.总长度：数据包的总长度
III.TTL(time-to-live)生产时间字段设置了数据报可以经过的最多路由器.超过就会丢弃


II.IP路由选择
1.搜索路由表找到目的IP完全匹配的表目
2.搜索路由表找到能与目的网络号匹配的网络
3.发到默认到下一站路由器

II.子网掩码

ifconfig
netstat

------------------------------------------------------------------------------------------
I.ARP地址解析 知道IP查硬件地址
tcpdump   -e打印出硬件地址
arp命令

IP地址和mac地址绑定



I.RARP地址解析
无盘系统引导获得IP地址



----------------------------------------------------------------------------------------
I.ICMP:internet控制报文协议
是IP层的一个组成部分

II.ICMP时间戳请求应答


I.ping 走IP层不走tcp/udp层

I.traceroute 追踪者

(0段和127段不使用)
A类IP段　1.0.0.0 到126.255.255.255   默认子网掩码　255.0.0.0　一个子网最多可以容纳1677万多台电脑
B类IP段　128.0.0.0 到191.255.255.255 默认子网掩码　255.255.0.0　一个子网最多可以容纳6万台电脑
C类IP段　192.0.0.0 到223.255.255.255 默认子网掩码　255.255.255.0　一个子网最多可以容纳254台电脑


I.netstat路由表

Ip选路，查找路由表

I.RIP 选路信息协议

I.UDP协议

I.
host
src
dst
port

监控 XX网卡  IP都是10.1*地址的请求
tcpdump -i eno16777736 host 10.1.125.152

过滤本机是 eth1网卡 IP是192的地址
tcpdump -i eno16777736 src host 10.1.125.152

只显示，目的地址是 54.250IP的数据
tcpdump -i eno16777736 dst host 54.250.145.96

过滤本机端口
tcpdump -i eno16777736 src port 25

过滤目的端口
tcpdump -i eth1 dst port 25

过滤协议
tcpdump -i eth1 arp


54.250.145.96


tcpdump -i eno16777736 host www.hpolearning.com

tcpdump -i eno16777736 src host 10.1.125.152



只显示，目的地址是 54.250IP的数据
tcpdump -i eno16777736 dst host 10.1.125.152


I.路由表
netstat -rn

I.RIP 选路信息协议

I.UDP用户数据协议
RFC 768有UDP规范

SLIP（Serial Line Internet Protocol，串行线路网际协议
数据链路层协议

UDP默认开始UDP校验，发送端和接收端都要校验：0未开启

I.IP分片 可能在发送端也可能在路由
物理网络层限制数据帧的最大长度



tcpdump -i eno16777736 host 10.1.120.124


I.arp -a 查看ARP 告诉缓存

I.IGMP Internet 组管理协议称为IGMP协议（Internet Group Management Protocol）
udp 多播 组播
MulticastSocket
* 在Java UDP中单播与广播的代码是相同的,要实现具有广播功能的程序只需要使用广播地址即可, 例如：这里使用了本地的广播地址
  DatagramPacket


I.14章DNS是一种tcp/ip程序的分布式数据库		
树状结构，一个DNS子树称为一个区域zone
DNS报文格式

I.DNS端口号53 不论tcp udp

I.15 TFTP
和FTP不一样用UDP实现

I.BOOTP引导程序协议
使用UDP.
知道地址不知道IP  RARP

I.17 TCP
面向链接的
客户端发送信息等待服务端响应，如果超时没响应，则重新发送
数据包会切分成适合的数据块大小
有重复的数据包会丢弃
TCP每一方都有一个固定大小的缓冲空间，可以进行流量控制


TCP首部
16位源端口号 16位目的端口号

I.18 TCP连接建立与终止

tcp全双工
tcp连接由一个4元组唯一确定：本地IP、端口，远程IP、端口

tcp通过让接收方指明希望从发送方接收的数据字节数来进行流量控制
路径MTU发现、窗口扩大选项、时间戳选项、序号回绕保护、改进TCP事务处理

I.25 SNMP
时间的SNMP管理进程和SNMP代理进程之间的请求-应答协议

I.26Telnet Rlogin
telnet 都是tcpIP协议模块进行交互

I.ftp
和普通tcp不同，它在客户进程和服务器进程之间使用两个TCP连接  一个控制连接，另一个按需求随时创建和撤销数据连接

I.smtp协议
发邮件

成功开启POP3/SMTP服务,在第三方客户端登录时，密码框请输入以下授权码：
wisdsoqaxpngbahh



Base64加密解密
http://tool.chinaz.com/Tools/Base64.aspx

telnet smtp.buaa.edu.cn 25
220 buaa.edu.cn Anti-spam GT for Coremail System (buaa[20140724])
helo localhost
250 OK
auth login
334 dXNlcm5hbWU6
ZGluZ3NhaTg4QGJ1YWEuZWR1LmNu
334 UGFzc3dvcmQ6
ZGluZ3NhaTE5ODg=
235 Authentication successful
mail from:<dingsai88@buaa.edu.cn>
250 Mail OK
rcpt to:<dingsai88@qq.com>
250 Mail OK
data
354 End data with <CR><LF>.<CR><LF>
from:<dingsai88@buaa.edu.cn>
to:<dingsai88@qq.com>
subject:hello,dingsai88@qq.com

hello smtp
.
250 Mail OK queued as AQAQrABnbdGqjxlXSNvqAA--.7207S2

重点是换行"."是结束



rcpt to:<dingsai88@126.com>


附件

4.1  3.1  
第三方




telnet smtp.buaa.edu.cn 25
220 buaa.edu.cn Anti-spam GT for Coremail System (buaa[20140724])
helo localhost
250 OK
auth login
334 dXNlcm5hbWU6
ZGluZbaseb4email
334 UGFzc3dvcmQ6
Zbase64password
235 Authentication successful
mail from:<dingsai88@buaa.edu.cn>
250 Mail OK
rcpt to:<dingsai88@qq.com>
250 Mail OK
data
354 End data with <CR><LF>.<CR><LF>
from:<dingsai88@buaa.edu.cn>
to:<dingsai88@qq.com>
subject:hello,dingsai88@qq.com

hello smtp
.
250 Mail OK queued as AQAQrABnbdGqjxlXSNvqAA--.7207S2




I.http
根据RFC2616，HTTP Method是区分大小写的，而Header是不区分的。
所以 GET/POST/PUT等需要大写，而content-encoding/user-agent则不用。

http://www.ietf.org/rfc/rfc2616.txt

telnet www.baidu.com 80
get /

II.客户端缓存
If-Modified-Since:

[root@localhost ~]# telnet 210.76.*.* 80
Trying 210.76.*.*...
Connected to 210.76.*.*.
Escape character is '^]'.
GET /Advanced/pic/image007.jpg HTTP/1.0
If-Modified-Since:Tuesday, 03-May-16 17:23:00 GMT

HTTP/1.1 304 Not Modified   --无修改
Server: Apache-Coyote/1.1
Set-Cookie: JSESSIONID=810CEDE09B1FDE4CEA0AB8854951BD78; Path=/Advanced/; HttpOnly
P3P: CP=CAO PSA OUR
ETag: W/"187656-1451311454171"
Date: Tue, 03 May 2016 09:38:31 GMT
Connection: close

Connection closed by foreign host.

II.	重定向
[root@localhost ~]# telnet www.noao.edu 80
Trying 140.252.1.28...
Connected to www.noao.edu.
Escape character is '^]'.
GET /~rstevens HTTP/1.0

HTTP/1.1 302 Found
Date: Tue, 03 May 2016 09:43:01 GMT
Server: Apache/2.2.29 (FreeBSD) PHP/5.3.21 with Suhosin-Patch mod_ssl/2.2.29 OpenSSL/1.0.2g DAV/2 mod_perl/2.0.8 Perl/v5.14.4
Location: http://www.kohala.com/~rstevens
Content-Length: 215
Connection: close
Content-Type: text/html; charset=iso-8859-1

<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
<html><head>
<title>302 Found</title>
</head><body>
<h1>Found</h1>
<p>The document has moved <a href="http://www.kohala.com/~rstevens">here</a>.</p>
</body></html>
Connection closed by foreign host.






I.HTTP
根据RFC2616，HTTP Method是区分大小写的，而Header是不区分的。
所以 GET/POST/PUT等需要大写，而content-encoding/user-agent则不用。

http://www.ietf.org/rfc/rfc2616.txt

telnet www.baidu.com 80
get /

II.客户端缓存
If-Modified-Since:

[root@localhost ~]# telnet 210.76.*.* 80
Trying 210.76.*.*...
Connected to 210.76.*.*.
Escape character is '^]'.
GET /Advanced/pic/image007.jpg HTTP/1.0
If-Modified-Since:Tuesday, 03-May-16 17:23:00 GMT

HTTP/1.1 304 Not Modified   --无修改
Server: Apache-Coyote/1.1
Set-Cookie: JSESSIONID=810CEDE09B1FDE4CEA0AB8854951BD78; Path=/Advanced/; HttpOnly
P3P: CP=CAO PSA OUR
ETag: W/"187656-1451311454171"
Date: Tue, 03 May 2016 09:38:31 GMT
Connection: close

Connection closed by foreign host.

II.	重定向
[root@localhost ~]# telnet www.noao.edu 80
Trying 140.252.1.28...
Connected to www.noao.edu.
Escape character is '^]'.
GET /~rstevens HTTP/1.0

HTTP/1.1 302 Found
Date: Tue, 03 May 2016 09:43:01 GMT
Server: Apache/2.2.29 (FreeBSD) PHP/5.3.21 with Suhosin-Patch mod_ssl/2.2.29 OpenSSL/1.0.2g DAV/2 mod_perl/2.0.8 Perl/v5.14.4
Location: http://www.kohala.com/~rstevens
Content-Length: 215
Connection: close
Content-Type: text/html; charset=iso-8859-1

<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
<html><head>
<title>302 Found</title>
</head><body>
<h1>Found</h1>
<p>The document has moved <a href="http://www.kohala.com/~rstevens">here</a>.</p>
</body></html>
Connection closed by foreign host.

 
I.http://www.cnblogs.com/cswuyg/p/3653263.html



--------------------------------------------------------------------------

I. 网络访问相关

II. IP地址 结构:
struct in_addr{
uint32_t s_add;
}


II.套接字接口 socket 接口是一组函数
EOF :End Of File   read函数返回0时

III.socket客户端 相关函数
open_clientfd:getaddrinfo
open_clientfd:socket(int domain ,int type,int protocol): 创建一个套接字描述符，还不能读写
open_clientfd:connect(int clientfd ,sockaddr *addr,socklen_t addrlen):客户端通过connect函数建立和服务器的连接
rio_writen
rio_readlineb
close



III.socket服务端 相关函数
open_listenfd:getaddrinfo:主机名、地址、服务、端口字符串转化成套接字地址结构
open_listenfd:socket
open_listenfd:bind(int sockfd,sockaddr *addr ,socklen_t addrlen):服务端用来绑定
open_listenfd:listen(int sockfd,int backlog):服务端用来监听
accept(int listenfd,sockaddr *addr ,int addrlen):等待客户端的连接请求
rio_readlineb
rio_writen
rio_readlineb
close



getnameinfo函数:和getaddrinfo相反，套接字地址结构转化成主机等信息


open_clientfd(char hostname,char port)函数 :客户端与服务器建立连接
相当于getaddrinfo、socket、connect


open_listenfd(char port)函数 :服务端创建一个监听描述符，准备接收请求
相当于getaddrinfo、socket、bind、listen


I.并发编程


II.基于进程
fork函数、exec、waitpid函数

客户端和之前的套接字socket一样open_clientfd

服务端，收到一个请求以后新建一个进程，提供服务




II.基于IO多路复用 multiplexing

https://blog.csdn.net/glpghz/article/details/107562004


II.基于多线程

多线程时由共享变量

Edsger dijkstra 并发大神
信号量semaphore:
用信号量同步线程(解决共享变量)
PV

P(s):如果s是非零就-1,立即返回。如果s等于0就挂起本线程，直到s变为非0，V操作会重启本线程。
V(s):s加1。 如果有线程阻塞在P操作，那么V重启其中一个，然后将改线程-1，完成P操作。







I.链路层

三个目的:
1.IP模块发送和接收IP数据报。
2.ARP模块发送ARP请求和接收ARP应答。
3.为RARP发送RARP请求和接收RARP应答。

TCPIP支持多种不同的链路层协议，取决于使用的硬件
以太网
令牌环网
FDDI光纤分布式数据接口
RS-232串行线路


**以太网:标准**

数字设备公司Digital Equipment Corp 、英特尔Interl公司 、施乐Xerox公司联合公布的标准。

是主要的局域网技术。
采用CSMA/CD的媒体接入方法。

速率10Mb/s


**IEEE标准**
IEEE电子电气工程师协会 的 802委员会 标准。


IEEE 802标准 :
802.3 标准 针对用CSMA/CD标准
802.4 针对令牌总线网络
802.5 针对令牌环网络

共性:三者由802.2标准定义，共有逻辑链路控制LLC 

802.2、802.3的标准和以太网标准帧格式不同。

**链路层协议 -以太网和IEEE 实现**

RFC894 、RFC1042

以太网IP数据报:封装在
RFC 894 [Horning 1984]

IEEE802网络 封装
RFC 1042 [Postel and Reynolds 1988]


**主机需求RFC要求**

每台Internet主机都和一个10Mbs以太网电缆连接:
总结：
1.必须支持收发以太网实现RFC 894
2.可以能收发IEEE标准实现RFC 1042 。或混合模式


1) 必须能发送和接收采用RFC 894（以太网）封装格式的分组。
2) 应该能接收与RFC 894混合的RFC 1042（IEEE 802）封装格式的分组。
3) 也许能够发送采用RFC 1042格式封装的分组。如果主机能同时发送两种类型的分组数
 据，那么发送的分组必须是可以设置的，而且默认条件下必须是RFC 894分组。


https://blog.csdn.net/ctthuangcheng/article/details/9703719


http://www.360doc.com/content/19/0519/14/30647790_836709624.shtml






I. tcp详解等

II.http详解等


