
第12章 Java内存模型与线程
   并发处理的广泛应用是使得amdahl定律代替默认定律成为计算机性能发展源动力的根
本原因，也是人类压榨计算机运算能力的最有力武器。

12.1概述
    多任务处理在现代计算机操作系统中几乎已是一项必备的功能了。在许多情况下，让
计算机同时去做几件事情，不仅是因为计算机的运算能力强大了，还有一个很重要的原因是
计算机的运算速度与它的存储和通信子系统速度的差距太大，大量的时间都花费在磁盘I/O、
网络通信或数据库访问上。如果不希望处理器在大部分时间里都处于等待其他资源的状
态，就必须使用一些手段去把处理的运算能力“压榨”出来，否则就会造成很大的浪费，
而让计算机同事处理机箱任务则是最容易想到、也被证明是非常有效的压榨手段。
    除了充分利用计算机处理器的能力外，一个服务端同时对多个客户端提供服务则是两一个
更具体的并发应用场景。衡量一个服务性能的高低好坏，每秒事务处理数transactions
per second tps是最重要的性能指标之一，它代表着1秒内服务端平均能响应的请求总数，而
TPS值与程序的并发能力又有非常密切的关系。对于计算量相同的任务，程序线程并发协调
得越有条不紊，效率自然就会越高；反之线程之间频繁阻塞甚至死锁，将会大大降低程序
的并发能力。
   服务端是java语言最擅长的领域之一，这个领域的应用占了java应用中最大的一块份
额，不过如何写好并发应用程序却又是服务端程序开发的难点之一，处理好并发方面的问
题通常需要更多的编码经验来支持。幸好java语言和虚拟机提供了许多工具，把并发编程
的门槛降低了不少。并且各种中间件服务器、各类框架都努力地替程序员处理尽可能多的线
程并发细节，使得程序员在编码时能更关注业务逻辑，而不是划分大部分时间去关注此服务
会同时被多少人调用、如何协调硬件资源。无论语言、中间件和框架如何先进，开发人员都
不能期望它们能独立完成所有并发处理的事情，了解并发的内部也是成为一个高级程序员不
可缺少的课程。
   高效开发是本书讲解java虚拟机的最后一部分，将会向读者介绍虚拟机如何实现多
线程、多线程之间由与共享和竞争数据而导致的一系列问题及解决方案。

12.2 硬件的效率与一致性
   在正式讲解虚拟机并发相关的知识之前，我们先花费一点时间去了解一下屋里计算
机中的并发问题，物理机遇到的并发问题与虚拟机中的情况有不少相似之处，物理机对并发
的处理方案对于虚拟机的实现也有相当打的参考意义。
   让计算机并发执行若干个运算任务与更充分地利用计算机处理器的效能之间的
因果关系，看起来顺利成章，实际上并没有想象中的那么简单，其中一个重
要的复杂性来源是绝大多数的运算任务都不可能只靠处理器计算就能完成，处理器至少
要与内存交互，如读取运算数据、存储运算结果等，这个IO操作是很难消除的（无法仅靠
寄存器来完成所有的运算任务）。


















